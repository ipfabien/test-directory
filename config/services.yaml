services:
  _defaults:
    autowire: true
    autoconfigure: true

  # Controllers as services (exclude DTO *Request classes).
  App\Controller\:
    resource: "../src/Controller/"
    public: true
    tags: ["controller.service_arguments"]
    exclude: "../src/Controller/**/*Request.php"

  # Other services
  App\:
    resource: "../src/*"
    exclude: "../src/{DependencyInjection,Entity,Tests,Kernel.php,Controller}"

  App\Services\Http\ArgumentResolver\JsonBodyNormalizableResolver:
    tags:
      - { name: controller.argument_value_resolver, priority: 100 }

  App\Services\Http\ArgumentResolver\QueryNormalizableResolver:
    tags:
      - { name: controller.argument_value_resolver, priority: 50 }

  App\Domain\Contact\ContactRepository: '@App\Services\Repository\Dbal\DBALContactRepository'

  App\Domain\Manager\ManagerRepository: '@App\Services\Repository\Dbal\DBALManagerRepository'

  # Event bus injection for the CreateContact controller.
  App\Controller\Api\Contact\CreateContactController:
    public: true
    arguments:
      $eventBus: "@messenger.default_bus"

  App\Services\Http\EventSubscriber\ExceptionSubscriber:
    tags:
      - { name: kernel.event_subscriber }

  App\Services\Security\JwtTokenService:
    arguments:
      $secret: "%env(JWT_SECRET)%"

  # Default email sender; tests override this via services_test.yaml.
  App\Domain\Email\SendEmail: '@App\Services\Email\SymfonyMailerSendEmail'
